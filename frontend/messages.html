<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Messages - Together Culture</title>
    <link rel="icon" type="image/png" href="/tfav.png" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="./css/style.css" />
    <style>
        .message-bubble {
            max-width: 70%;
            word-wrap: break-word;
        }
        .message-sent {
            background-color: #3b82f6;
            color: white;
            margin-left: auto;
        }
        .message-received {
            background-color: #f3f4f6;
            color: #1f2937;
        }
        .conversation-item:hover {
            background-color: #f9fafb;
        }
        .conversation-item.active {
            background-color: #eff6ff;
            border-right: 3px solid #3b82f6;
        }
        .chat-container {
            height: calc(100vh - 140px);
        }
        .messages-area {
            height: calc(100% - 80px);
            overflow-y: auto;
        }
        .compose-area {
            height: 80px;
        }
        .loading-spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.5);
        }
        .unread-badge {
            background-color: #ef4444;
            color: white;
            font-size: 11px;
            padding: 2px 6px;
            border-radius: 10px;
            min-width: 18px;
            text-align: center;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-lg">
        <div class="main-container flex items-center justify-between h-16">
            <div class="flex items-center gap-6">
                <a href="/" class="flex items-center gap-2">
                    <svg class="h-8 w-8 brand-text-primary" viewBox="0 0 48 48" fill="none">
                        <path d="M39.5563 34.1455V13.8546C39.5563 15.708 36.8773 17.3437 32.7927 18.3189C30.2914 18.916 27.263 19.2655 24 19.2655C20.737 19.2655 17.7086 18.916 15.2073 18.3189C11.1227 17.3437 8.44365 15.708 8.44365 13.8546V34.1455C8.44365 35.9988 11.1227 37.6346 15.2073 38.6098C17.7086 39.2069 20.737 39.5564 24 39.5564C27.263 39.5564 30.2914 39.2069 32.7927 38.6098C36.8773 37.6346 39.5563 35.9988 39.5563 34.1455Z" fill="currentColor"></path>
                    </svg>
                    <h1 class="text-xl font-bold brand-text-dark">Together Culture</h1>
                </a>
                <div class="hidden md:flex items-center gap-4">
                    <a id="dashboard-link" href="./member_dashboard.html" class="text-gray-600 hover:text-gray-900">Dashboard</a>
                    <a href="./events.html" class="text-gray-600 hover:text-gray-900">Events</a>
                    <a href="./messages.html" class="text-brand-primary font-medium">Messages</a>
                    <a href="./resources.html" class="text-gray-600 hover:text-gray-900">Resources</a>
                </div>
            </div>
            <div class="flex items-center gap-4">
                <span id="user-name" class="text-sm text-gray-600"></span>
                <button id="logout-btn" class="px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-lg hover:bg-red-700 transition-colors">Logout</button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="grid grid-cols-12 gap-6 h-screen">
                <!-- Members & Conversations -->
                <div class="col-span-4 space-y-4">
                    <!-- Members List -->
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                        <div class="p-4 border-b border-gray-200">
                            <h2 class="text-lg font-semibold text-gray-900">Start New Chat</h2>
                            <div class="mt-2">
                                <input type="text" id="search-members" placeholder="Search members..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-primary">
                            </div>
                        </div>
                        <div id="members-list" class="overflow-y-auto max-h-64">
                            <!-- Members will be loaded here -->
                        </div>
                    </div>

                    <!-- Existing Conversations -->
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                        <div class="p-4 border-b border-gray-200">
                            <h2 class="text-lg font-semibold text-gray-900">Recent Conversations</h2>
                        </div>
                        <div id="conversations-container" class="overflow-y-auto max-h-96">
                            <!-- Conversations will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Chat Area -->
                <div class="col-span-8 bg-white rounded-lg shadow-sm border border-gray-200 flex flex-col" id="chat-container">
                    <div id="chat-header" class="p-4 border-b border-gray-200">
                        <p class="text-gray-500">Select a member or conversation to start messaging</p>
                    </div>
                    <div id="chat-messages" class="flex-1 p-4 overflow-y-auto">
                        <div class="flex items-center justify-center h-full">
                            <p class="text-gray-500">No conversation selected</p>
                        </div>
                    </div>
                    <div id="chat-input" class="p-4 border-t border-gray-200">
                        <div class="flex gap-2">
                            <input type="text" id="message-input" placeholder="Type a message..." class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-primary" disabled>
                            <button id="send-button" class="px-4 py-2 bg-brand-primary text-white rounded-lg hover:bg-brand-primary/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed" disabled>Send</button>
                        </div>
                    </div>
                </div>
            </div>


    <!-- Conversation Info Modal -->
    <div id="conversation-info-modal" class="hidden fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 transition-opacity modal-backdrop" onclick="closeConversationInfoModal()"></div>
            <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="flex items-start justify-between mb-4">
                        <h3 class="text-lg font-medium text-gray-900">Conversation Details</h3>
                        <button onclick="closeConversationInfoModal()" class="text-gray-400 hover:text-gray-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>

                    <div id="conversation-info-content"></div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button onclick="closeConversationInfoModal()" 
                            class="w-full sm:w-auto inline-flex justify-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-primary">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="/js/config.js"></script>
    <script src="/js/auth.js"></script>
    <script src="/js/messages.js"></script>
</body>
</html>