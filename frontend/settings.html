<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Settings - Together Culture</title>
    <link rel="icon" type="image/png" href="/tfav.png" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="./css/style.css" />
    <style>
        .loading-spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.5);
        }
        .avatar-upload-zone {
            border: 2px dashed #d1d5db;
            transition: all 0.3s ease;
        }
        .avatar-upload-zone.dragover {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
        .avatar-preview {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid #e5e7eb;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .tab-button.active {
            border-bottom: 2px solid #3b82f6;
            color: #3b82f6;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-lg">
        <div class="main-container flex items-center justify-between h-16">
            <div class="flex items-center gap-6">
                <a href="/" class="flex items-center gap-2">
                    <svg class="h-8 w-8 brand-text-primary" viewBox="0 0 48 48" fill="none">
                        <path d="M39.5563 34.1455V13.8546C39.5563 15.708 36.8773 17.3437 32.7927 18.3189C30.2914 18.916 27.263 19.2655 24 19.2655C20.737 19.2655 17.7086 18.916 15.2073 18.3189C11.1227 17.3437 8.44365 15.708 8.44365 13.8546V34.1455C8.44365 35.9988 11.1227 37.6346 15.2073 38.6098C17.7086 39.2069 20.737 39.5564 24 39.5564C27.263 39.5564 30.2914 39.2069 32.7927 38.6098C36.8773 37.6346 39.5563 35.9988 39.5563 34.1455Z" fill="currentColor"></path>
                    </svg>
                    <h1 class="text-xl font-bold brand-text-dark">Together Culture</h1>
                </a>
                <div class="hidden md:flex items-center gap-4">
                    <a href="/member_dashboard.html" class="text-gray-600 hover:text-gray-900">Dashboard</a>
                    <a href="/events.html" class="text-gray-600 hover:text-gray-900">Events</a>
                    <a href="/messages.html" class="text-gray-600 hover:text-gray-900">Messages</a>
                    <a href="/resources.html" class="text-gray-600 hover:text-gray-900">Resources</a>
                    <a href="/settings.html" class="text-brand-primary font-medium">Settings</a>
                </div>
            </div>
            <div class="flex items-center gap-4">
                <span id="user-name" class="text-sm text-gray-600"></span>
                <button id="logout-btn" class="text-sm text-red-600 hover:text-red-800">Logout</button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="main-container py-8">
        <!-- Header -->
        <div class="mb-8">
            <h1 class="text-3xl font-bold text-gray-900">Account Settings</h1>
            <p class="text-gray-600 mt-1">Manage your profile, preferences, and account settings</p>
        </div>

        <!-- Tabs -->
        <div class="bg-white rounded-lg shadow-sm">
            <div class="border-b border-gray-200">
                <nav class="flex space-x-8 px-6">
                    <button class="tab-button active py-4 px-1 border-b-2 font-medium text-sm focus:outline-none" data-tab="profile">
                        Profile
                    </button>
                    <button class="tab-button py-4 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium text-sm focus:outline-none" data-tab="avatar">
                        Avatar
                    </button>
                    <button class="tab-button py-4 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium text-sm focus:outline-none" data-tab="password">
                        Password
                    </button>
                    <button class="tab-button py-4 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium text-sm focus:outline-none" data-tab="preferences">
                        Preferences
                    </button>
                    <button class="tab-button py-4 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium text-sm focus:outline-none" data-tab="activity">
                        Activity
                    </button>
                    <button class="tab-button py-4 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium text-sm focus:outline-none" data-tab="danger">
                        Account
                    </button>
                </nav>
            </div>

            <!-- Profile Tab -->
            <div id="profile-tab" class="tab-content active p-6">
                <h2 class="text-xl font-semibold text-gray-900 mb-6">Profile Information</h2>
                <form id="profile-form" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Full Name *</label>
                            <input type="text" id="profile-full-name" name="full_name" required
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-brand-primary">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                            <input type="email" id="profile-email" readonly
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50 text-gray-500">
                            <p class="text-xs text-gray-500 mt-1">Email cannot be changed</p>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Bio</label>
                        <textarea id="profile-bio" name="bio" rows="4" maxlength="1000"
                                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-brand-primary"
                                  placeholder="Tell us about yourself..."></textarea>
                        <p class="text-xs text-gray-500 mt-1"><span id="bio-count">0</span>/1000 characters</p>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Skills</label>
                        <input type="text" id="profile-skills" name="skills" maxlength="500"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-brand-primary"
                               placeholder="e.g. JavaScript, Project Management, Design">
                        <p class="text-xs text-gray-500 mt-1">Separate skills with commas. <span id="skills-count">0</span>/500 characters</p>
                    </div>
                    
                    <div class="flex justify-end">
                        <button type="submit" id="profile-submit-btn"
                                class="px-6 py-2 bg-brand-primary text-white rounded-lg font-medium hover:bg-brand-primary/90 focus:outline-none focus:ring-2 focus:ring-brand-primary disabled:opacity-50 disabled:cursor-not-allowed">
                            <span class="submit-text">Update Profile</span>
                            <div class="hidden submit-loading loading-spinner ml-2"></div>
                        </button>
                    </div>
                </form>
            </div>

            <!-- Avatar Tab -->
            <div id="avatar-tab" class="tab-content p-6">
                <h2 class="text-xl font-semibold text-gray-900 mb-6">Profile Avatar</h2>
                <div class="flex items-start gap-8">
                    <div class="flex flex-col items-center">
                        <div class="avatar-preview bg-gray-200 flex items-center justify-center mb-4">
                            <img id="current-avatar" class="avatar-preview hidden" />
                            <div id="avatar-placeholder" class="text-gray-400">
                                <svg class="w-12 h-12" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                                </svg>
                            </div>
                        </div>
                        <div class="flex gap-2">
                            <button id="remove-avatar-btn" class="hidden px-3 py-1 text-sm text-red-600 border border-red-600 rounded hover:bg-red-50">
                                Remove
                            </button>
                        </div>
                    </div>
                    
                    <div class="flex-1">
                        <div id="avatar-upload-zone" class="avatar-upload-zone border-2 border-dashed border-gray-300 rounded-lg p-8 text-center cursor-pointer hover:border-gray-400 transition-colors">
                            <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                                <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                            <div class="mt-4">
                                <p class="text-sm text-gray-600">
                                    <span class="font-medium text-brand-primary hover:text-brand-primary/80">Click to upload</span>
                                    or drag and drop
                                </p>
                                <p class="text-xs text-gray-500 mt-1">PNG, JPG, GIF up to 5MB</p>
                            </div>
                            <input type="file" id="avatar-input" accept="image/*" class="hidden">
                        </div>
                        
                        <div class="mt-4">
                            <button id="upload-avatar-btn" class="hidden px-4 py-2 bg-brand-primary text-white rounded-lg font-medium hover:bg-brand-primary/90 disabled:opacity-50 disabled:cursor-not-allowed">
                                <span class="upload-text">Upload Avatar</span>
                                <div class="hidden upload-loading loading-spinner ml-2"></div>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Password Tab -->
            <div id="password-tab" class="tab-content p-6">
                <h2 class="text-xl font-semibold text-gray-900 mb-6">Change Password</h2>
                <form id="password-form" class="space-y-6 max-w-md">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Current Password *</label>
                        <div class="relative">
                            <input type="password" id="current-password" name="current_password" required
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-brand-primary pr-10">
                            <button type="button" class="toggle-password absolute inset-y-0 right-0 pr-3 flex items-center">
                                <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">New Password *</label>
                        <div class="relative">
                            <input type="password" id="new-password" name="new_password" required minlength="6"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-brand-primary pr-10">
                            <button type="button" class="toggle-password absolute inset-y-0 right-0 pr-3 flex items-center">
                                <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                </svg>
                            </button>
                        </div>
                        <p class="text-xs text-gray-500 mt-1">Must be at least 6 characters long</p>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Confirm New Password *</label>
                        <div class="relative">
                            <input type="password" id="confirm-password" name="confirm_password" required
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-brand-primary pr-10">
                            <button type="button" class="toggle-password absolute inset-y-0 right-0 pr-3 flex items-center">
                                <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    <div class="flex justify-end">
                        <button type="submit" id="password-submit-btn"
                                class="px-6 py-2 bg-brand-primary text-white rounded-lg font-medium hover:bg-brand-primary/90 focus:outline-none focus:ring-2 focus:ring-brand-primary disabled:opacity-50 disabled:cursor-not-allowed">
                            <span class="submit-text">Change Password</span>
                            <div class="hidden submit-loading loading-spinner ml-2"></div>
                        </button>
                    </div>
                </form>
            </div>

            <!-- Preferences Tab -->
            <div id="preferences-tab" class="tab-content p-6">
                <h2 class="text-xl font-semibold text-gray-900 mb-6">Preferences</h2>
                <form id="preferences-form" class="space-y-6 max-w-md">
                    <div>
                        <h3 class="text-lg font-medium text-gray-900 mb-4">Notifications</h3>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <label class="text-sm font-medium text-gray-700">Email Notifications</label>
                                    <p class="text-xs text-gray-500">Receive updates via email</p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" id="email-notifications" name="email_notifications" class="sr-only peer">
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                </label>
                            </div>
                            
                            <div class="flex items-center justify-between">
                                <div>
                                    <label class="text-sm font-medium text-gray-700">Push Notifications</label>
                                    <p class="text-xs text-gray-500">Receive browser notifications</p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" id="push-notifications" name="push_notifications" class="sr-only peer">
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <h3 class="text-lg font-medium text-gray-900 mb-4">Privacy</h3>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Profile Visibility</label>
                            <select id="privacy-level" name="privacy_level" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-brand-primary">
                                <option value="public">Public - Visible to everyone</option>
                                <option value="members">Members Only - Visible to approved members</option>
                                <option value="private">Private - Only visible to admins</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="flex justify-end">
                        <button type="submit" id="preferences-submit-btn"
                                class="px-6 py-2 bg-brand-primary text-white rounded-lg font-medium hover:bg-brand-primary/90 focus:outline-none focus:ring-2 focus:ring-brand-primary disabled:opacity-50 disabled:cursor-not-allowed">
                            <span class="submit-text">Save Preferences</span>
                            <div class="hidden submit-loading loading-spinner ml-2"></div>
                        </button>
                    </div>
                </form>
            </div>

            <!-- Activity Tab -->
            <div id="activity-tab" class="tab-content p-6">
                <h2 class="text-xl font-semibold text-gray-900 mb-6">Recent Activity</h2>
                <div id="activity-loading" class="flex justify-center py-8">
                    <div class="loading-spinner"></div>
                </div>
                <div id="activity-list" class="hidden space-y-4"></div>
                <div id="no-activity" class="hidden text-center py-8 text-gray-500">
                    No recent activity found
                </div>
            </div>

            <!-- Account/Danger Tab -->
            <div id="danger-tab" class="tab-content p-6">
                <h2 class="text-xl font-semibold text-gray-900 mb-6">Account Management</h2>
                <div class="bg-red-50 border border-red-200 rounded-lg p-6">
                    <h3 class="text-lg font-semibold text-red-800 mb-4">Danger Zone</h3>
                    <p class="text-sm text-red-700 mb-4">
                        Once you delete your account, there is no going back. Please be certain.
                    </p>
                    <button id="delete-account-btn" class="px-4 py-2 bg-red-600 text-white rounded-lg font-medium hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500">
                        Delete Account
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Account Confirmation Modal -->
    <div id="delete-account-modal" class="hidden fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 transition-opacity modal-backdrop" onclick="closeDeleteModal()"></div>
            <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10">
                            <svg class="h-6 w-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                            </svg>
                        </div>
                        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
                            <h3 class="text-lg leading-6 font-medium text-gray-900">Delete Account</h3>
                            <div class="mt-2">
                                <p class="text-sm text-gray-500">
                                    Are you sure you want to delete your account? This action cannot be undone and all your data will be permanently removed.
                                </p>
                                <div class="mt-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Enter your password to confirm:</label>
                                    <input type="password" id="delete-password" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button id="confirm-delete-btn" type="button" 
                            class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm disabled:opacity-50 disabled:cursor-not-allowed">
                        <span class="delete-text">Delete Account</span>
                        <div class="hidden delete-loading loading-spinner ml-2"></div>
                    </button>
                    <button onclick="closeDeleteModal()" type="button" 
                            class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-primary sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="/js/config.js"></script>
    <script src="/js/auth.js"></script>
    <script src="/js/settings.js"></script>
</body>
</html>
